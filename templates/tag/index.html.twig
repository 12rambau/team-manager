{% extends 'layout.html.twig' %}

{% block title %}Tag index
{% endblock %}

{% block content %}

    <div class="jumbotron">
        <h2>Tag index</h2>
    </div>

    {{ form_start(form) }}

    {{ form_errors(form) }}

    <table class="table" data-prototype="
                                {% filter escape('html_attr') %}
                                    {% include 'tag/prototype.html.twig' with {'form':form} only %}
                                {% endfilter %}" id="tag-list">
        <tr>
            <th>Tag name</th>
            <th>color</th>
            <th>calendar view</th>
            <th>actions</th>
        </tr>
        {% for tag in listTags %}
            <tr>
                <td>{{ tag.name }}</td>
                <td class="text-{{ tag.color }}">{{ tag.color }}</td>
                <td>
                    <span class="btn btn-{{ tag.color }}">{{ tag.name }}</span>
                </td>
                <td>
                    <a class="btn btn-outline-danger" href="{{ path('tag-delete', {'name':tag.name}) }}">
                        <span class="">
                            <i class="fas fa-trash"></i>
                        </span>
                    </a>
                </td>
            </tr>
        {% endfor %}
    </table>

    {{ form_rest(form) }}

    {{ form_end(form) }}

    <div class="text-center" id="add-button"></div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        var addTagButton = $('<a id="tag_add" class="btn btn-block btn-success" href="#">add tag</a>');

        $(document).ready(function() {

            //add the button 
            $("#add-button").append(addTagButton);
        });

        $(document).on('click', "#tag_add", function(e){

            var tagHolder = $("#tag-list");
            var prototype = tagHolder.attr('data-prototype');

            //add the prototype in <tr>
            tagHolder.append(prototype);
            //remove the add button
            $("#add-button").children().remove();

        });

        $(document).on('click', '#tag_cancel', function(e){
            //remove the form
            $("#form-row").remove();
            //add the button
            $("#add-button").append(addTagButton);

        });

        $(document).on('change', '#tag_name', function(event){
            var name = $(event.target).val();
            $("#form-preview").text(name);
        });

        $(document).on('change', "#tag_color", function(event){
            var color = $(event.target).val();
            $("#form-preview").attr('class', 'btn btn-'+color);
        });
   
    </script>
{% endblock %}